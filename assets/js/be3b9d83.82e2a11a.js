"use strict";(globalThis.webpackChunkai_matey_docs=globalThis.webpackChunkai_matey_docs||[]).push([[143],{1184:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>s});var i=r(4041);const t={},d=i.createContext(t);function a(e){const n=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(d.Provider,{value:n},e.children)}},2678:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>g,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"tutorials/beginner/using-middleware","title":"Tutorial 02: Using Middleware","description":"Learn how to enhance your Bridge with logging, caching, and retry middleware for production-ready applications.","source":"@site/docs/tutorials/beginner/02-using-middleware.md","sourceDirName":"tutorials/beginner","slug":"/tutorials/beginner/using-middleware","permalink":"/ai.matey/tutorials/beginner/using-middleware","draft":false,"unlisted":false,"editUrl":"https://github.com/johnhenry/ai.matey/tree/main/packages/ai.matey.docs/docs/tutorials/beginner/02-using-middleware.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docs","previous":{"title":"Tutorial 01: Simple Bridge","permalink":"/ai.matey/tutorials/beginner/simple-bridge"},"next":{"title":"Tutorial 03: Multi-Provider Routing","permalink":"/ai.matey/tutorials/beginner/multi-provider"}}');var t=r(1085),d=r(1184);const a={sidebar_position:2},s="Tutorial 02: Using Middleware",l={},o=[{value:"What You&#39;ll Build",id:"what-youll-build",level:2},{value:"Time Required",id:"time-required",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"What is Middleware?",id:"what-is-middleware",level:2},{value:"Step 1: Install Middleware Package",id:"step-1-install-middleware-package",level:2},{value:"Step 2: Add Logging Middleware",id:"step-2-add-logging-middleware",level:2},{value:"Step 3: Add Caching Middleware",id:"step-3-add-caching-middleware",level:2},{value:"Step 4: Add Retry Middleware",id:"step-4-add-retry-middleware",level:2},{value:"Middleware Order Matters!",id:"middleware-order-matters",level:2},{value:"Step 5: Combine Everything",id:"step-5-combine-everything",level:2},{value:"Additional Middleware",id:"additional-middleware",level:2},{value:"Cost Tracking",id:"cost-tracking",level:3},{value:"Transform Middleware",id:"transform-middleware",level:3},{value:"Building Custom Middleware",id:"building-custom-middleware",level:2},{value:"Middleware Interface",id:"middleware-interface",level:3},{value:"Advanced Patterns",id:"advanced-patterns",level:2},{value:"Conditional Middleware",id:"conditional-middleware",level:3},{value:"Middleware with State",id:"middleware-with-state",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"&quot;Middleware not executing&quot;",id:"middleware-not-executing",level:3},{value:"&quot;Cache not working&quot;",id:"cache-not-working",level:3},{value:"&quot;Too many retries&quot;",id:"too-many-retries",level:3},{value:"Next Steps",id:"next-steps",level:2},{value:"Complete Example",id:"complete-example",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"tutorial-02-using-middleware",children:"Tutorial 02: Using Middleware"})}),"\n",(0,t.jsx)(n.p,{children:"Learn how to enhance your Bridge with logging, caching, and retry middleware for production-ready applications."}),"\n",(0,t.jsx)(n.h2,{id:"what-youll-build",children:"What You'll Build"}),"\n",(0,t.jsx)(n.p,{children:"A production-grade Bridge with:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Logging"})," to track all requests and responses"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Caching"})," to reduce API costs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Retry logic"})," for resilience"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"time-required",children:"Time Required"}),"\n",(0,t.jsxs)(n.p,{children:["\u23f1\ufe0f ",(0,t.jsx)(n.strong,{children:"15 minutes"})]}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Completed ",(0,t.jsx)(n.a,{href:"/tutorials/beginner/simple-bridge",children:"Tutorial 01: Simple Bridge"})]}),"\n",(0,t.jsx)(n.li,{children:"An AI provider API key"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"what-is-middleware",children:"What is Middleware?"}),"\n",(0,t.jsx)(n.p,{children:"Middleware are functions that intercept requests and responses as they flow through your Bridge. They can:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Log"})," requests/responses for debugging"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cache"})," responses to reduce costs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Retry"})," failed requests automatically"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Transform"})," data on-the-fly"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Track costs"})," and usage"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Add authentication"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Request\n   \u2193\nLogging Middleware (logs request)\n   \u2193\nCaching Middleware (checks cache)\n   \u2193\nRetry Middleware (handles failures)\n   \u2193\nBackend Adapter \u2192 AI Provider\n   \u2193\nRetry Middleware (retries on error)\n   \u2193\nCaching Middleware (stores response)\n   \u2193\nLogging Middleware (logs response)\n   \u2193\nResponse\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-1-install-middleware-package",children:"Step 1: Install Middleware Package"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install ai.matey.middleware\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-2-add-logging-middleware",children:"Step 2: Add Logging Middleware"}),"\n",(0,t.jsx)(n.p,{children:"Logging helps you debug and monitor your application:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { Bridge } from 'ai.matey.core';\nimport { OpenAIFrontendAdapter } from 'ai.matey.frontend/openai';\nimport { AnthropicBackendAdapter } from 'ai.matey.backend/anthropic';\nimport { createLoggingMiddleware } from 'ai.matey.middleware';\n\nconst bridge = new Bridge(\n  new OpenAIFrontendAdapter(),\n  new AnthropicBackendAdapter({ apiKey: process.env.ANTHROPIC_API_KEY })\n);\n\n// Add logging middleware\nbridge.use(\n  createLoggingMiddleware({\n    level: 'info',           // Log level: 'debug', 'info', 'warn', 'error'\n    logRequests: true,       // Log outgoing requests\n    logResponses: true,      // Log incoming responses\n    redactFields: ['apiKey'] // Don't log sensitive data\n  })\n);\n\n// Now all requests will be logged\nconst response = await bridge.chat({\n  model: 'gpt-4',\n  messages: [{ role: 'user', content: 'Hello!' }]\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Console output:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[INFO] Request: POST /chat/completions\n[INFO] Model: gpt-4\n[INFO] Messages: 1\n[INFO] Response: 200 OK (1.2s)\n[INFO] Tokens: 50\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-3-add-caching-middleware",children:"Step 3: Add Caching Middleware"}),"\n",(0,t.jsx)(n.p,{children:"Caching reduces costs by storing responses:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import {\n  createLoggingMiddleware,\n  createCachingMiddleware\n} from 'ai.matey.middleware';\n\nbridge.use(createLoggingMiddleware({ level: 'info' }));\n\n// Add caching\nbridge.use(\n  createCachingMiddleware({\n    ttl: 3600,        // Cache for 1 hour (in seconds)\n    maxSize: 1000,    // Max 1000 cached items\n    storage: 'memory' // or 'redis', 'file'\n  })\n);\n\n// First request - hits the API\nconst response1 = await bridge.chat({\n  model: 'gpt-4',\n  messages: [{ role: 'user', content: 'What is 2+2?' }]\n});\nconsole.log('First request took:', response1.latency, 'ms');\n\n// Second identical request - served from cache!\nconst response2 = await bridge.chat({\n  model: 'gpt-4',\n  messages: [{ role: 'user', content: 'What is 2+2?' }]\n});\nconsole.log('Second request took:', response2.latency, 'ms'); // < 1ms\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Console output:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[INFO] Request: Model=gpt-4, Messages=1\n[INFO] Cache miss - fetching from API\n[INFO] Response: 200 OK (1200ms)\n[INFO] Request: Model=gpt-4, Messages=1\n[INFO] Cache hit! \u2713\n[INFO] Response: 200 OK (0.5ms)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-4-add-retry-middleware",children:"Step 4: Add Retry Middleware"}),"\n",(0,t.jsx)(n.p,{children:"Retry failed requests automatically:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import {\n  createLoggingMiddleware,\n  createCachingMiddleware,\n  createRetryMiddleware\n} from 'ai.matey.middleware';\n\nbridge.use(createLoggingMiddleware({ level: 'info' }));\nbridge.use(createCachingMiddleware({ ttl: 3600 }));\n\n// Add retry logic\nbridge.use(\n  createRetryMiddleware({\n    maxAttempts: 3,        // Try up to 3 times\n    initialDelay: 1000,    // Wait 1s before first retry\n    maxDelay: 10000,       // Max 10s between retries\n    backoffMultiplier: 2,  // Double delay each time (1s, 2s, 4s)\n    retryableErrors: [     // Which errors to retry\n      'RATE_LIMIT_EXCEEDED',\n      'TIMEOUT',\n      'SERVICE_UNAVAILABLE'\n    ]\n  })\n);\n\n// If this fails, it will automatically retry\nconst response = await bridge.chat({\n  model: 'gpt-4',\n  messages: [{ role: 'user', content: 'Hello!' }]\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Console output (if provider fails):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[INFO] Request: Model=gpt-4, Messages=1\n[WARN] Request failed: RATE_LIMIT_EXCEEDED\n[INFO] Retrying in 1000ms (attempt 1/3)\n[INFO] Request: Model=gpt-4, Messages=1\n[INFO] Response: 200 OK (1100ms)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"middleware-order-matters",children:"Middleware Order Matters!"}),"\n",(0,t.jsxs)(n.p,{children:["Middleware is executed in the order you add it. The ",(0,t.jsx)(n.strong,{children:"last middleware added runs first"})," (like an onion):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// \u274c Wrong order\nbridge.use(createCachingMiddleware({ ttl: 3600 }));  // Runs 3rd\nbridge.use(createRetryMiddleware({ maxAttempts: 3 })); // Runs 2nd\nbridge.use(createLoggingMiddleware({ level: 'info' })); // Runs 1st\n\n// \u2705 Correct order\nbridge.use(createLoggingMiddleware({ level: 'info' })); // Runs 1st (logs everything)\nbridge.use(createRetryMiddleware({ maxAttempts: 3 }));  // Runs 2nd (retries if needed)\nbridge.use(createCachingMiddleware({ ttl: 3600 }));     // Runs 3rd (caches successful responses)\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Best practice:"})," Logging first, then retry, then caching."]}),"\n",(0,t.jsx)(n.h2,{id:"step-5-combine-everything",children:"Step 5: Combine Everything"}),"\n",(0,t.jsx)(n.p,{children:"Here's a production-ready Bridge with all three middlewares:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import 'dotenv/config';\nimport { Bridge } from 'ai.matey.core';\nimport { OpenAIFrontendAdapter } from 'ai.matey.frontend/openai';\nimport { AnthropicBackendAdapter } from 'ai.matey.backend/anthropic';\nimport {\n  createLoggingMiddleware,\n  createRetryMiddleware,\n  createCachingMiddleware,\n} from 'ai.matey.middleware';\n\n// Create bridge\nconst bridge = new Bridge(\n  new OpenAIFrontendAdapter(),\n  new AnthropicBackendAdapter({\n    apiKey: process.env.ANTHROPIC_API_KEY\n  })\n);\n\n// Add middleware (order matters!)\nbridge.use(\n  createLoggingMiddleware({\n    level: 'info',\n    logRequests: true,\n    logResponses: true,\n    redactFields: ['apiKey', 'authorization']\n  })\n);\n\nbridge.use(\n  createRetryMiddleware({\n    maxAttempts: 3,\n    initialDelay: 1000,\n    maxDelay: 10000,\n    backoffMultiplier: 2\n  })\n);\n\nbridge.use(\n  createCachingMiddleware({\n    ttl: 3600,\n    maxSize: 1000,\n    storage: 'memory'\n  })\n);\n\n// Use it\nasync function chat(message) {\n  const response = await bridge.chat({\n    model: 'gpt-4',\n    messages: [{ role: 'user', content: message }]\n  });\n  return response.choices[0].message.content;\n}\n\n// Test it\nconsole.log(await chat('What is ai.matey?'));\nconsole.log(await chat('What is ai.matey?')); // Cached!\n"})}),"\n",(0,t.jsx)(n.h2,{id:"additional-middleware",children:"Additional Middleware"}),"\n",(0,t.jsx)(n.h3,{id:"cost-tracking",children:"Cost Tracking"}),"\n",(0,t.jsx)(n.p,{children:"Track API costs in real-time:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { createCostTrackingMiddleware } from 'ai.matey.middleware';\n\nbridge.use(\n  createCostTrackingMiddleware({\n    budgetLimit: 100,     // Alert when cost exceeds $100\n    alertThreshold: 0.9,  // Alert at 90% of budget\n    onBudgetExceeded: () => {\n      console.error('Budget exceeded!');\n      // Send alert email, Slack message, etc.\n    }\n  })\n);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"transform-middleware",children:"Transform Middleware"}),"\n",(0,t.jsx)(n.p,{children:"Modify requests/responses on-the-fly:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { createTransformMiddleware } from 'ai.matey.middleware';\n\nbridge.use(\n  createTransformMiddleware({\n    transformRequest: (request) => {\n      // Add a system message to every request\n      return {\n        ...request,\n        messages: [\n          { role: 'system', content: 'Be concise' },\n          ...request.messages\n        ]\n      };\n    },\n    transformResponse: (response) => {\n      // Transform all responses to uppercase\n      return {\n        ...response,\n        choices: response.choices.map(choice => ({\n          ...choice,\n          message: {\n            ...choice.message,\n            content: choice.message.content.toUpperCase()\n          }\n        }))\n      };\n    }\n  })\n);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"building-custom-middleware",children:"Building Custom Middleware"}),"\n",(0,t.jsx)(n.p,{children:"You can create your own middleware:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"function createTimingMiddleware() {\n  return {\n    name: 'timing',\n    async execute(request, next) {\n      const start = Date.now();\n\n      const response = await next(request);\n\n      const duration = Date.now() - start;\n      console.log(`Request took ${duration}ms`);\n\n      return response;\n    }\n  };\n}\n\nbridge.use(createTimingMiddleware());\n"})}),"\n",(0,t.jsx)(n.h3,{id:"middleware-interface",children:"Middleware Interface"}),"\n",(0,t.jsx)(n.p,{children:"All middleware must implement:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface Middleware {\n  name: string;\n  execute(request: any, next: Function): Promise<any>;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"next"})," function calls the next middleware in the chain."]}),"\n",(0,t.jsx)(n.h2,{id:"advanced-patterns",children:"Advanced Patterns"}),"\n",(0,t.jsx)(n.h3,{id:"conditional-middleware",children:"Conditional Middleware"}),"\n",(0,t.jsx)(n.p,{children:"Only apply middleware for certain requests:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"bridge.use({\n  name: 'conditional-cache',\n  async execute(request, next) {\n    // Only cache if model is gpt-3.5-turbo\n    if (request.model === 'gpt-3.5-turbo') {\n      return cacheMiddleware.execute(request, next);\n    }\n    return next(request);\n  }\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"middleware-with-state",children:"Middleware with State"}),"\n",(0,t.jsx)(n.p,{children:"Create middleware that maintains state:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"function createRequestCounterMiddleware() {\n  let count = 0;\n\n  return {\n    name: 'request-counter',\n    async execute(request, next) {\n      count++;\n      console.log(`Request #${count}`);\n      return next(request);\n    },\n    getCount: () => count,\n    reset: () => { count = 0; }\n  };\n}\n\nconst counter = createRequestCounterMiddleware();\nbridge.use(counter);\n\n// Later\nconsole.log('Total requests:', counter.getCount());\n"})}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"middleware-not-executing",children:'"Middleware not executing"'}),"\n",(0,t.jsxs)(n.p,{children:["Make sure you're calling ",(0,t.jsx)(n.code,{children:"bridge.use()"})," ",(0,t.jsx)(n.strong,{children:"before"})," making any requests:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Correct\nconst bridge = new Bridge(...);\nbridge.use(createLoggingMiddleware({ level: 'info' }));\nawait bridge.chat({ ... }); // Middleware runs\n\n// \u274c Wrong\nconst bridge = new Bridge(...);\nawait bridge.chat({ ... }); // No middleware\nbridge.use(createLoggingMiddleware({ level: 'info' }));\n"})}),"\n",(0,t.jsx)(n.h3,{id:"cache-not-working",children:'"Cache not working"'}),"\n",(0,t.jsxs)(n.p,{children:["Make sure caching middleware is added ",(0,t.jsx)(n.strong,{children:"after"})," retry middleware:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Correct order\nbridge.use(createLoggingMiddleware());\nbridge.use(createRetryMiddleware());\nbridge.use(createCachingMiddleware()); // Caches successful retries\n\n// \u274c Wrong order\nbridge.use(createCachingMiddleware());\nbridge.use(createRetryMiddleware()); // Retries happen before cache\n"})}),"\n",(0,t.jsx)(n.h3,{id:"too-many-retries",children:'"Too many retries"'}),"\n",(0,t.jsxs)(n.p,{children:["Lower your ",(0,t.jsx)(n.code,{children:"maxAttempts"})," or add specific retry conditions:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"bridge.use(\n  createRetryMiddleware({\n    maxAttempts: 2, // Only retry once\n    shouldRetry: (error) => {\n      // Only retry rate limits, not auth errors\n      return error.code === 'RATE_LIMIT_EXCEEDED';\n    }\n  })\n);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsx)(n.p,{children:"Great work! You've learned how to use middleware to make your Bridge production-ready."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Continue learning:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/tutorials/beginner/multi-provider",children:"Tutorial 03: Multi-Provider Routing"})," - Use multiple providers"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/johnhenry/ai.matey/tree/main/packages/ai.matey.docs/examples/03-middleware",children:"Middleware Examples"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/packages/middleware",children:"Middleware Package Docs"})," - Complete middleware reference"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// production-bridge.js\nimport 'dotenv/config';\nimport { Bridge } from 'ai.matey.core';\nimport { OpenAIFrontendAdapter } from 'ai.matey.frontend/openai';\nimport { AnthropicBackendAdapter } from 'ai.matey.backend/anthropic';\nimport {\n  createLoggingMiddleware,\n  createRetryMiddleware,\n  createCachingMiddleware,\n  createCostTrackingMiddleware,\n} from 'ai.matey.middleware';\n\nfunction createProductionBridge(apiKey) {\n  const bridge = new Bridge(\n    new OpenAIFrontendAdapter(),\n    new AnthropicBackendAdapter({ apiKey })\n  );\n\n  // Middleware stack\n  bridge.use(createLoggingMiddleware({\n    level: process.env.LOG_LEVEL || 'info',\n    redactFields: ['apiKey', 'authorization']\n  }));\n\n  bridge.use(createRetryMiddleware({\n    maxAttempts: 3,\n    initialDelay: 1000,\n    backoffMultiplier: 2\n  }));\n\n  bridge.use(createCachingMiddleware({\n    ttl: 3600,\n    maxSize: 1000\n  }));\n\n  bridge.use(createCostTrackingMiddleware({\n    budgetLimit: 100,\n    onBudgetExceeded: () => {\n      console.error('\u26a0\ufe0f  Budget exceeded!');\n    }\n  }));\n\n  return bridge;\n}\n\n// Usage\nconst bridge = createProductionBridge(process.env.ANTHROPIC_API_KEY);\n\nasync function main() {\n  try {\n    const response = await bridge.chat({\n      model: 'gpt-4',\n      messages: [{ role: 'user', content: 'Explain middleware' }]\n    });\n    console.log(response.choices[0].message.content);\n  } catch (error) {\n    console.error('Error:', error.message);\n  }\n}\n\nmain();\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Ready for multi-provider routing?"})," Continue to ",(0,t.jsx)(n.a,{href:"/tutorials/beginner/multi-provider",children:"Tutorial 03: Multi-Provider Routing"})]})]})}function g(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);