"use strict";(globalThis.webpackChunkai_matey_docs=globalThis.webpackChunkai_matey_docs||[]).push([[8565],{1184:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>t});var i=n(4041);const s={},c=i.createContext(s);function a(e){const r=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(c.Provider,{value:r},e.children)}},5035:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"api/packages/middleware","title":"ai.matey.middleware","description":"Middleware components for AI Matey - Universal AI Adapter System","source":"@site/docs/api/packages/middleware.md","sourceDirName":"api/packages","slug":"/api/packages/middleware","permalink":"/ai.matey/api/packages/middleware","draft":false,"unlisted":false,"editUrl":"https://github.com/johnhenry/ai.matey/tree/main/packages/ai.matey.docs/docs/api/packages/middleware.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"docs","previous":{"title":"ai.matey.backend.browser","permalink":"/ai.matey/api/packages/backend-browser"},"next":{"title":"ai.matey.http","permalink":"/ai.matey/api/packages/http"}}');var s=n(1085),c=n(1184);const a={sidebar_position:9},t="ai.matey.middleware",d={},o=[{value:"Overview",id:"overview",level:2},{value:"Exports",id:"exports",level:2},{value:"Values",id:"values",level:3},{value:"<code>InMemoryCacheStorage</code>",id:"inmemorycachestorage",level:4},{value:"<code>createCachingMiddleware</code>",id:"createcachingmiddleware",level:4},{value:"<code>createConversationHistoryMiddleware</code>",id:"createconversationhistorymiddleware",level:4},{value:"<code>simpleConversationHistory</code>",id:"simpleconversationhistory",level:4},{value:"<code>statelessConversation</code>",id:"statelessconversation",level:4},{value:"<code>conversationOnlyHistory</code>",id:"conversationonlyhistory",level:4},{value:"<code>InMemoryCostStorage</code>",id:"inmemorycoststorage",level:4},{value:"<code>DEFAULT_PRICING</code>",id:"default_pricing",level:4},{value:"<code>calculateCost</code>",id:"calculatecost",level:4},{value:"<code>createCostTrackingMiddleware</code>",id:"createcosttrackingmiddleware",level:4},{value:"<code>createStreamingCostTrackingMiddleware</code>",id:"createstreamingcosttrackingmiddleware",level:4},{value:"<code>createLoggingMiddleware</code>",id:"createloggingmiddleware",level:4},{value:"<code>OpenTelemetryAttributes</code>",id:"opentelemetryattributes",level:4},{value:"<code>OpenTelemetryTelemetrySink</code>",id:"opentelemetrytelemetrysink",level:4},{value:"<code>isOpenTelemetryLoaded</code>",id:"isopentelemetryloaded",level:4},{value:"<code>createRetryMiddleware</code>",id:"createretrymiddleware",level:4},{value:"<code>isRateLimitError</code>",id:"isratelimiterror",level:4},{value:"<code>isNetworkError</code>",id:"isnetworkerror",level:4},{value:"<code>isServerError</code>",id:"isservererror",level:4},{value:"<code>createRetryPredicate</code>",id:"createretrypredicate",level:4},{value:"<code>DEFAULT_SECURITY_CONFIG</code>",id:"default_security_config",level:4},{value:"<code>createSecurityMiddleware</code>",id:"createsecuritymiddleware",level:4},{value:"<code>createProductionSecurityMiddleware</code>",id:"createproductionsecuritymiddleware",level:4},{value:"<code>createDevelopmentSecurityMiddleware</code>",id:"createdevelopmentsecuritymiddleware",level:4},{value:"<code>MetricNames</code>",id:"metricnames",level:4},{value:"<code>EventNames</code>",id:"eventnames",level:4},{value:"<code>createTelemetryMiddleware</code>",id:"createtelemetrymiddleware",level:4},{value:"<code>ConsoleTelemetrySink</code>",id:"consoletelemetrysink",level:4},{value:"<code>InMemoryTelemetrySink</code>",id:"inmemorytelemetrysink",level:4},{value:"<code>createTransformMiddleware</code>",id:"createtransformmiddleware",level:4},{value:"<code>createPromptRewriter</code>",id:"createpromptrewriter",level:4},{value:"<code>createParameterModifier</code>",id:"createparametermodifier",level:4},{value:"<code>createResponseFilter</code>",id:"createresponsefilter",level:4},{value:"<code>createSystemMessageInjector</code>",id:"createsystemmessageinjector",level:4},{value:"<code>createMessageFilter</code>",id:"createmessagefilter",level:4},{value:"<code>createContentSanitizer</code>",id:"createcontentsanitizer",level:4},{value:"<code>composeRequestTransformers</code>",id:"composerequesttransformers",level:4},{value:"<code>composeResponseTransformers</code>",id:"composeresponsetransformers",level:4},{value:"<code>composeMessageTransformers</code>",id:"composemessagetransformers",level:4},{value:"<code>DEFAULT_PII_PATTERNS</code>",id:"default_pii_patterns",level:4},{value:"<code>DEFAULT_INJECTION_PATTERNS</code>",id:"default_injection_patterns",level:4},{value:"<code>detectPII</code>",id:"detectpii",level:4},{value:"<code>redactPII</code>",id:"redactpii",level:4},{value:"<code>detectPromptInjection</code>",id:"detectpromptinjection",level:4},{value:"<code>sanitizeText</code>",id:"sanitizetext",level:4},{value:"<code>sanitizeRequest</code>",id:"sanitizerequest",level:4},{value:"<code>createValidationMiddleware</code>",id:"createvalidationmiddleware",level:4},{value:"<code>createProductionValidationMiddleware</code>",id:"createproductionvalidationmiddleware",level:4},{value:"<code>createDevelopmentValidationMiddleware</code>",id:"createdevelopmentvalidationmiddleware",level:4},{value:"Types",id:"types",level:3},{value:"<code>CachingConfig</code>",id:"cachingconfig",level:4},{value:"<code>ConversationHistoryConfig</code>",id:"conversationhistoryconfig",level:4},{value:"<code>ConversationHistoryManager</code>",id:"conversationhistorymanager",level:4},{value:"<code>ProviderPricing</code>",id:"providerpricing",level:4},{value:"<code>ModelPricing</code>",id:"modelpricing",level:4},{value:"<code>CostCalculation</code>",id:"costcalculation",level:4},{value:"<code>CostStorage</code>",id:"coststorage",level:4},{value:"<code>CostTrackingConfig</code>",id:"costtrackingconfig",level:4},{value:"<code>LogLevel</code>",id:"loglevel",level:4},{value:"<code>Logger</code>",id:"logger",level:4},{value:"<code>LoggingConfig</code>",id:"loggingconfig",level:4},{value:"<code>BatchSpanProcessorConfig</code>",id:"batchspanprocessorconfig",level:4},{value:"<code>OpenTelemetryConfig</code>",id:"opentelemetryconfig",level:4},{value:"<code>RetryConfig</code>",id:"retryconfig",level:4},{value:"<code>SecurityConfig</code>",id:"securityconfig",level:4},{value:"<code>TelemetryConfig</code>",id:"telemetryconfig",level:4},{value:"<code>RequestTransformer</code>",id:"requesttransformer",level:4},{value:"<code>ResponseTransformer</code>",id:"responsetransformer",level:4},{value:"<code>MessageTransformer</code>",id:"messagetransformer",level:4},{value:"<code>TransformConfig</code>",id:"transformconfig",level:4},{value:"<code>ValidationResult</code>",id:"validationresult",level:4},{value:"<code>PIIDetectionResult</code>",id:"piidetectionresult",level:4},{value:"<code>ModerationResult</code>",id:"moderationresult",level:4},{value:"<code>ValidationConfig</code>",id:"validationconfig",level:4},{value:"Usage",id:"usage",level:2},{value:"Source Code",id:"source-code",level:2},{value:"Quick Links",id:"quick-links",level:2}];function l(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"aimateymiddleware",children:"ai.matey.middleware"})}),"\n",(0,s.jsx)(r.p,{children:"Middleware components for AI Matey - Universal AI Adapter System"}),"\n",(0,s.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(r.p,{children:"This package is part of the ai.matey ecosystem."}),"\n",(0,s.jsx)(r.h2,{id:"exports",children:"Exports"}),"\n",(0,s.jsx)(r.h3,{id:"values",children:"Values"}),"\n",(0,s.jsx)(r.h4,{id:"inmemorycachestorage",children:(0,s.jsx)(r.code,{children:"InMemoryCacheStorage"})}),"\n",(0,s.jsx)(r.p,{children:"In-memory cache storage with LRU eviction."}),"\n",(0,s.jsx)(r.h4,{id:"createcachingmiddleware",children:(0,s.jsx)(r.code,{children:"createCachingMiddleware"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createCachingMiddlewareconfig: CachingConfig =\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createconversationhistorymiddleware",children:(0,s.jsx)(r.code,{children:"createConversationHistoryMiddleware"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createConversationHistoryMiddlewareconfig: ConversationHistoryConfig =\n"})}),"\n",(0,s.jsx)(r.h4,{id:"simpleconversationhistory",children:(0,s.jsx)(r.code,{children:"simpleConversationHistory"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"simpleConversationHistorymaxHistorySize: number = 10): Middleware\n"})}),"\n",(0,s.jsx)(r.h4,{id:"statelessconversation",children:(0,s.jsx)(r.code,{children:"statelessConversation"})}),"\n",(0,s.jsx)(r.p,{children:"Create a stateless conversation history middleware."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"statelessConversation): Middleware\n"})}),"\n",(0,s.jsx)(r.h4,{id:"conversationonlyhistory",children:(0,s.jsx)(r.code,{children:"conversationOnlyHistory"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"conversationOnlyHistorymaxHistorySize: number = 10): Middleware\n"})}),"\n",(0,s.jsx)(r.h4,{id:"inmemorycoststorage",children:(0,s.jsx)(r.code,{children:"InMemoryCostStorage"})}),"\n",(0,s.jsx)(r.h4,{id:"default_pricing",children:(0,s.jsx)(r.code,{children:"DEFAULT_PRICING"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"DEFAULT_PRICINGRecord<string, ProviderPricing> =\n"})}),"\n",(0,s.jsx)(r.h4,{id:"calculatecost",children:(0,s.jsx)(r.code,{children:"calculateCost"})}),"\n",(0,s.jsx)(r.p,{children:"Calculate cost for a request/response"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"calculateCostusage: IRUsage, provider: string, model: string, config: CostTrackingConfig ): CostCalculation\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createcosttrackingmiddleware",children:(0,s.jsx)(r.code,{children:"createCostTrackingMiddleware"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createCostTrackingMiddlewareconfig: CostTrackingConfig =\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createstreamingcosttrackingmiddleware",children:(0,s.jsx)(r.code,{children:"createStreamingCostTrackingMiddleware"})}),"\n",(0,s.jsx)(r.p,{children:"Create streaming cost tracking middleware"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createStreamingCostTrackingMiddlewareconfig: CostTrackingConfig =\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createloggingmiddleware",children:(0,s.jsx)(r.code,{children:"createLoggingMiddleware"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createLoggingMiddlewareconfig: LoggingConfig =\n"})}),"\n",(0,s.jsx)(r.h4,{id:"opentelemetryattributes",children:(0,s.jsx)(r.code,{children:"OpenTelemetryAttributes"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"OpenTelemetryAttributes\n"})}),"\n",(0,s.jsx)(r.h4,{id:"opentelemetrytelemetrysink",children:(0,s.jsx)(r.code,{children:"OpenTelemetryTelemetrySink"})}),"\n",(0,s.jsx)(r.h4,{id:"isopentelemetryloaded",children:(0,s.jsx)(r.code,{children:"isOpenTelemetryLoaded"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"isOpenTelemetryLoaded): boolean\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createretrymiddleware",children:(0,s.jsx)(r.code,{children:"createRetryMiddleware"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createRetryMiddlewareconfig: RetryConfig =\n"})}),"\n",(0,s.jsx)(r.h4,{id:"isratelimiterror",children:(0,s.jsx)(r.code,{children:"isRateLimitError"})}),"\n",(0,s.jsx)(r.p,{children:"Check if an error is a rate limit error."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"isRateLimitErrorerror: unknown): boolean\n"})}),"\n",(0,s.jsx)(r.h4,{id:"isnetworkerror",children:(0,s.jsx)(r.code,{children:"isNetworkError"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"isNetworkErrorerror: unknown): boolean\n"})}),"\n",(0,s.jsx)(r.h4,{id:"isservererror",children:(0,s.jsx)(r.code,{children:"isServerError"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"isServerErrorerror: unknown): boolean\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createretrypredicate",children:(0,s.jsx)(r.code,{children:"createRetryPredicate"})}),"\n",(0,s.jsx)(r.p,{children:"Create a retry predicate that only retries specific error types."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createRetryPredicateerrorTypes: Array<'rate_limit' | 'network' | 'server'> ): (error: unknown, attempt: number) => boolean\n"})}),"\n",(0,s.jsx)(r.h4,{id:"default_security_config",children:(0,s.jsx)(r.code,{children:"DEFAULT_SECURITY_CONFIG"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"DEFAULT_SECURITY_CONFIGRequired<Omit<SecurityConfig, 'customHeaders'>> =\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createsecuritymiddleware",children:(0,s.jsx)(r.code,{children:"createSecurityMiddleware"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createSecurityMiddlewareconfig: SecurityConfig =\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createproductionsecuritymiddleware",children:(0,s.jsx)(r.code,{children:"createProductionSecurityMiddleware"})}),"\n",(0,s.jsx)(r.p,{children:"Create production-ready security middleware with strict settings"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createProductionSecurityMiddleware): Middleware\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createdevelopmentsecuritymiddleware",children:(0,s.jsx)(r.code,{children:"createDevelopmentSecurityMiddleware"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createDevelopmentSecurityMiddleware): Middleware\n"})}),"\n",(0,s.jsx)(r.h4,{id:"metricnames",children:(0,s.jsx)(r.code,{children:"MetricNames"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"MetricNames\n"})}),"\n",(0,s.jsx)(r.h4,{id:"eventnames",children:(0,s.jsx)(r.code,{children:"EventNames"})}),"\n",(0,s.jsx)(r.p,{children:"Event names."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"EventNames\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createtelemetrymiddleware",children:(0,s.jsx)(r.code,{children:"createTelemetryMiddleware"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createTelemetryMiddlewareconfig: TelemetryConfig): Middleware\n"})}),"\n",(0,s.jsx)(r.h4,{id:"consoletelemetrysink",children:(0,s.jsx)(r.code,{children:"ConsoleTelemetrySink"})}),"\n",(0,s.jsx)(r.p,{children:"Console telemetry sink for development/debugging."}),"\n",(0,s.jsx)(r.h4,{id:"inmemorytelemetrysink",children:(0,s.jsx)(r.code,{children:"InMemoryTelemetrySink"})}),"\n",(0,s.jsx)(r.p,{children:"In-memory telemetry sink for testing."}),"\n",(0,s.jsx)(r.h4,{id:"createtransformmiddleware",children:(0,s.jsx)(r.code,{children:"createTransformMiddleware"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createTransformMiddlewareconfig: TransformConfig =\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createpromptrewriter",children:(0,s.jsx)(r.code,{children:"createPromptRewriter"})}),"\n",(0,s.jsx)(r.p,{children:"Create a prompt rewriting transformer."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createPromptRewriterrewriter: (text: string) => string | Promise<string> ): MessageTransformer\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createparametermodifier",children:(0,s.jsx)(r.code,{children:"createParameterModifier"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createParameterModifiermodifier: ( params: IRChatRequest['parameters'] ) => IRChatRequest['parameters'] | Promise<IRChatRequest['parameters']> ): RequestTransformer\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createresponsefilter",children:(0,s.jsx)(r.code,{children:"createResponseFilter"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createResponseFilterfilter: (response: IRChatResponse) => IRChatResponse | Promise<IRChatResponse> ): ResponseTransformer\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createsystemmessageinjector",children:(0,s.jsx)(r.code,{children:"createSystemMessageInjector"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createSystemMessageInjectorsystemMessage: string, position: 'start' | 'end' = 'start' ): RequestTransformer\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createmessagefilter",children:(0,s.jsx)(r.code,{children:"createMessageFilter"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createMessageFilterpredicate: (message: IRMessage) => boolean | Promise<boolean> ): RequestTransformer\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createcontentsanitizer",children:(0,s.jsx)(r.code,{children:"createContentSanitizer"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createContentSanitizersanitizer: (text: string) => string | Promise<string> ): MessageTransformer\n"})}),"\n",(0,s.jsx)(r.h4,{id:"composerequesttransformers",children:(0,s.jsx)(r.code,{children:"composeRequestTransformers"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"composeRequestTransformers...transformers: RequestTransformer[] ): RequestTransformer\n"})}),"\n",(0,s.jsx)(r.h4,{id:"composeresponsetransformers",children:(0,s.jsx)(r.code,{children:"composeResponseTransformers"})}),"\n",(0,s.jsx)(r.p,{children:"Compose multiple response transformers."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"composeResponseTransformers...transformers: ResponseTransformer[] ): ResponseTransformer\n"})}),"\n",(0,s.jsx)(r.h4,{id:"composemessagetransformers",children:(0,s.jsx)(r.code,{children:"composeMessageTransformers"})}),"\n",(0,s.jsx)(r.p,{children:"Compose multiple message transformers."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"composeMessageTransformers...transformers: MessageTransformer[] ): MessageTransformer\n"})}),"\n",(0,s.jsx)(r.h4,{id:"default_pii_patterns",children:(0,s.jsx)(r.code,{children:"DEFAULT_PII_PATTERNS"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"DEFAULT_PII_PATTERNSRecord<string, RegExp> =\n"})}),"\n",(0,s.jsx)(r.h4,{id:"default_injection_patterns",children:(0,s.jsx)(r.code,{children:"DEFAULT_INJECTION_PATTERNS"})}),"\n",(0,s.jsx)(r.p,{children:"Default prompt injection patterns"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"DEFAULT_INJECTION_PATTERNSRegExp[] = [ // Ignore previous instructions /ignore\\s+(previous|above|all)\\s+(instructions|prompts?|commands?)/i, // System prompt manipulation /system\\s*:\\s*new\\s+(instruction|prompt|role)/i, // Jailbreak attempts /\\b(jailbreak|DAN|developer\\s+mode)\\b/i, // Role manipulation /(you\\s+are\\s+now|act\\s+as\\s+if\\s+you\\s+are)\\s+a\\s+/i, // Instruction override /disregard\\s+(all|any|previous|above)/i, ]; /** * Detect PII in text */ exp\n"})}),"\n",(0,s.jsx)(r.h4,{id:"detectpii",children:(0,s.jsx)(r.code,{children:"detectPII"})}),"\n",(0,s.jsx)(r.p,{children:"Detect PII in text"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"detectPIItext: string, patterns: Record<string, RegExp> = DEFAULT_PII_PATTERNS ): PIIDetectionResult\n"})}),"\n",(0,s.jsx)(r.h4,{id:"redactpii",children:(0,s.jsx)(r.code,{children:"redactPII"})}),"\n",(0,s.jsx)(r.p,{children:"Redact PII from text"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"redactPIItext: string, patterns: Record<string, RegExp> = DEFAULT_PII_PATTERNS ): string\n"})}),"\n",(0,s.jsx)(r.h4,{id:"detectpromptinjection",children:(0,s.jsx)(r.code,{children:"detectPromptInjection"})}),"\n",(0,s.jsx)(r.p,{children:"Detect prompt injection attempts"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"detectPromptInjectiontext: string, patterns: RegExp[] = DEFAULT_INJECTION_PATTERNS ): boolean\n"})}),"\n",(0,s.jsx)(r.h4,{id:"sanitizetext",children:(0,s.jsx)(r.code,{children:"sanitizeText"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"sanitizeTexttext: string): string\n"})}),"\n",(0,s.jsx)(r.h4,{id:"sanitizerequest",children:(0,s.jsx)(r.code,{children:"sanitizeRequest"})}),"\n",(0,s.jsx)(r.p,{children:"Sanitize request"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"sanitizeRequestrequest: IRChatRequest, config: ValidationConfig): IRChatRequest\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createvalidationmiddleware",children:(0,s.jsx)(r.code,{children:"createValidationMiddleware"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createValidationMiddlewareconfig: ValidationConfig =\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createproductionvalidationmiddleware",children:(0,s.jsx)(r.code,{children:"createProductionValidationMiddleware"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createProductionValidationMiddleware): Middleware\n"})}),"\n",(0,s.jsx)(r.h4,{id:"createdevelopmentvalidationmiddleware",children:(0,s.jsx)(r.code,{children:"createDevelopmentValidationMiddleware"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"createDevelopmentValidationMiddleware): Middleware\n"})}),"\n",(0,s.jsx)(r.h3,{id:"types",children:"Types"}),"\n",(0,s.jsx)(r.h4,{id:"cachingconfig",children:(0,s.jsx)(r.code,{children:"CachingConfig"})}),"\n",(0,s.jsx)(r.p,{children:"Configuration for caching middleware."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"CachingConfig\n"})}),"\n",(0,s.jsx)(r.h4,{id:"conversationhistoryconfig",children:(0,s.jsx)(r.code,{children:"ConversationHistoryConfig"})}),"\n",(0,s.jsx)(r.p,{children:"Configuration for conversation history middleware."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"ConversationHistoryConfig\n"})}),"\n",(0,s.jsx)(r.h4,{id:"conversationhistorymanager",children:(0,s.jsx)(r.code,{children:"ConversationHistoryManager"})}),"\n",(0,s.jsx)(r.p,{children:"Conversation history manager for accessing and manipulating history."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"ConversationHistoryManager\n"})}),"\n",(0,s.jsx)(r.h4,{id:"providerpricing",children:(0,s.jsx)(r.code,{children:"ProviderPricing"})}),"\n",(0,s.jsx)(r.p,{children:"Provider pricing configuration"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"ProviderPricing\n"})}),"\n",(0,s.jsx)(r.h4,{id:"modelpricing",children:(0,s.jsx)(r.code,{children:"ModelPricing"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"ModelPricing\n"})}),"\n",(0,s.jsx)(r.h4,{id:"costcalculation",children:(0,s.jsx)(r.code,{children:"CostCalculation"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"CostCalculation\n"})}),"\n",(0,s.jsx)(r.h4,{id:"coststorage",children:(0,s.jsx)(r.code,{children:"CostStorage"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"CostStorage\n"})}),"\n",(0,s.jsx)(r.h4,{id:"costtrackingconfig",children:(0,s.jsx)(r.code,{children:"CostTrackingConfig"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"CostTrackingConfig\n"})}),"\n",(0,s.jsx)(r.h4,{id:"loglevel",children:(0,s.jsx)(r.code,{children:"LogLevel"})}),"\n",(0,s.jsx)(r.p,{children:"Log level."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"LogLevel  = 'debug' | 'info' | 'warn' | 'error'\n"})}),"\n",(0,s.jsx)(r.h4,{id:"logger",children:(0,s.jsx)(r.code,{children:"Logger"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"Logger\n"})}),"\n",(0,s.jsx)(r.h4,{id:"loggingconfig",children:(0,s.jsx)(r.code,{children:"LoggingConfig"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"LoggingConfig\n"})}),"\n",(0,s.jsx)(r.h4,{id:"batchspanprocessorconfig",children:(0,s.jsx)(r.code,{children:"BatchSpanProcessorConfig"})}),"\n",(0,s.jsx)(r.p,{children:"Batch span processor configuration."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"BatchSpanProcessorConfig\n"})}),"\n",(0,s.jsx)(r.h4,{id:"opentelemetryconfig",children:(0,s.jsx)(r.code,{children:"OpenTelemetryConfig"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"OpenTelemetryConfig\n"})}),"\n",(0,s.jsx)(r.h4,{id:"retryconfig",children:(0,s.jsx)(r.code,{children:"RetryConfig"})}),"\n",(0,s.jsx)(r.p,{children:"Configuration for retry middleware."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"RetryConfig\n"})}),"\n",(0,s.jsx)(r.h4,{id:"securityconfig",children:(0,s.jsx)(r.code,{children:"SecurityConfig"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"SecurityConfig\n"})}),"\n",(0,s.jsx)(r.h4,{id:"telemetryconfig",children:(0,s.jsx)(r.code,{children:"TelemetryConfig"})}),"\n",(0,s.jsx)(r.p,{children:"Configuration for telemetry middleware."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"TelemetryConfig\n"})}),"\n",(0,s.jsx)(r.h4,{id:"requesttransformer",children:(0,s.jsx)(r.code,{children:"RequestTransformer"})}),"\n",(0,s.jsx)(r.p,{children:"Request transformer function."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"RequestTransformer  = (request: IRChatRequest) => IRChatRequest | Promise<IRChatRequest>\n"})}),"\n",(0,s.jsx)(r.h4,{id:"responsetransformer",children:(0,s.jsx)(r.code,{children:"ResponseTransformer"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"ResponseTransformer  = ( response: IRChatResponse ) => IRChatResponse | Promise<IRChatResponse>\n"})}),"\n",(0,s.jsx)(r.h4,{id:"messagetransformer",children:(0,s.jsx)(r.code,{children:"MessageTransformer"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"MessageTransformer  = (message: IRMessage) => IRMessage | Promise<IRMessage>\n"})}),"\n",(0,s.jsx)(r.h4,{id:"transformconfig",children:(0,s.jsx)(r.code,{children:"TransformConfig"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"TransformConfig\n"})}),"\n",(0,s.jsx)(r.h4,{id:"validationresult",children:(0,s.jsx)(r.code,{children:"ValidationResult"})}),"\n",(0,s.jsx)(r.p,{children:"Validation result"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"ValidationResult\n"})}),"\n",(0,s.jsx)(r.h4,{id:"piidetectionresult",children:(0,s.jsx)(r.code,{children:"PIIDetectionResult"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"PIIDetectionResult\n"})}),"\n",(0,s.jsx)(r.h4,{id:"moderationresult",children:(0,s.jsx)(r.code,{children:"ModerationResult"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"ModerationResult\n"})}),"\n",(0,s.jsx)(r.h4,{id:"validationconfig",children:(0,s.jsx)(r.code,{children:"ValidationConfig"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"ValidationConfig\n"})}),"\n",(0,s.jsx)(r.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"import {\n  InMemoryCacheStorage,\n  createCachingMiddleware,\n  createConversationHistoryMiddleware,\n  simpleConversationHistory,\n  statelessConversation,\n  conversationOnlyHistory,\n  InMemoryCostStorage,\n  DEFAULT_PRICING,\n  calculateCost,\n  createCostTrackingMiddleware,\n  createStreamingCostTrackingMiddleware,\n  createLoggingMiddleware,\n  OpenTelemetryAttributes,\n  OpenTelemetryTelemetrySink,\n  isOpenTelemetryLoaded,\n  createRetryMiddleware,\n  isRateLimitError,\n  isNetworkError,\n  isServerError,\n  createRetryPredicate,\n  DEFAULT_SECURITY_CONFIG,\n  createSecurityMiddleware,\n  createProductionSecurityMiddleware,\n  createDevelopmentSecurityMiddleware,\n  MetricNames,\n  EventNames,\n  createTelemetryMiddleware,\n  ConsoleTelemetrySink,\n  InMemoryTelemetrySink,\n  createTransformMiddleware,\n  createPromptRewriter,\n  createParameterModifier,\n  createResponseFilter,\n  createSystemMessageInjector,\n  createMessageFilter,\n  createContentSanitizer,\n  composeRequestTransformers,\n  composeResponseTransformers,\n  composeMessageTransformers,\n  DEFAULT_PII_PATTERNS,\n  DEFAULT_INJECTION_PATTERNS,\n  detectPII,\n  redactPII,\n  detectPromptInjection,\n  sanitizeText,\n  sanitizeRequest,\n  createValidationMiddleware,\n  createProductionValidationMiddleware,\n  createDevelopmentValidationMiddleware\n} from 'ai.matey.middleware';\n\nimport type {\n  CachingConfig,\n  ConversationHistoryConfig,\n  ConversationHistoryManager,\n  ProviderPricing,\n  ModelPricing,\n  CostCalculation,\n  CostStorage,\n  CostTrackingConfig,\n  LogLevel,\n  Logger,\n  LoggingConfig,\n  BatchSpanProcessorConfig,\n  OpenTelemetryConfig,\n  RetryConfig,\n  SecurityConfig,\n  TelemetryConfig,\n  RequestTransformer,\n  ResponseTransformer,\n  MessageTransformer,\n  TransformConfig,\n  ValidationResult,\n  PIIDetectionResult,\n  ModerationResult,\n  ValidationConfig\n} from 'ai.matey.middleware';\n"})}),"\n",(0,s.jsx)(r.h2,{id:"source-code",children:"Source Code"}),"\n",(0,s.jsx)(r.p,{children:"View the complete source code and implementation details:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://github.com/johnhenry/ai.matey/tree/main/packages/middleware",children:"Package Source Code"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://github.com/johnhenry/ai.matey/tree/main/packages/middleware/src",children:"View on GitHub"})}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"quick-links",children:"Quick Links"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://github.com/johnhenry/ai.matey/tree/main/packages/ai.matey.docs/examples",children:"Examples"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/getting-started/installation",children:"Main Documentation"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/api/all-packages",children:"All Packages"})}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["See the ",(0,s.jsx)(r.a,{href:"https://github.com/johnhenry/ai.matey/tree/main/packages/middleware",children:"package source"})," for complete API documentation and examples."]})]})}function h(e={}){const{wrapper:r}={...(0,c.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);