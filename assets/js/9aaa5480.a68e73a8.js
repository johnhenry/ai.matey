"use strict";(globalThis.webpackChunkai_matey_docs=globalThis.webpackChunkai_matey_docs||[]).push([[5024],{1184:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>i});var t=r(4041);const s={},a=t.createContext(s);function c(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(a.Provider,{value:n},e.children)}},3540:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"api/router","title":"Router API","description":"Complete API reference for the Router class - intelligent routing across multiple backend providers.","source":"@site/docs/api/router.md","sourceDirName":"api","slug":"/api/router","permalink":"/ai.matey/api/router","draft":false,"unlisted":false,"editUrl":"https://github.com/johnhenry/ai.matey/tree/main/packages/ai.matey.docs/docs/api/router.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docs","previous":{"title":"Bridge API","permalink":"/ai.matey/api/bridge"},"next":{"title":"Middleware API","permalink":"/ai.matey/api/middleware"}}');var s=r(1085),a=r(1184);const c={sidebar_position:2},i="Router API",d={},o=[{value:"Constructor",id:"constructor",level:2},{value:"<code>new Router(frontendAdapter, options)</code>",id:"new-routerfrontendadapter-options",level:3},{value:"Methods",id:"methods",level:2},{value:"<code>chat(request)</code>",id:"chatrequest",level:3},{value:"<code>chatStream(request)</code>",id:"chatstreamrequest",level:3},{value:"<code>use(middleware)</code>",id:"usemiddleware",level:3},{value:"<code>addBackend(backend, weight?)</code>",id:"addbackendbackend-weight",level:3},{value:"<code>removeBackend(backendName)</code>",id:"removebackendbackendname",level:3},{value:"<code>setStrategy(strategy, customStrategy?)</code>",id:"setstrategystrategy-customstrategy",level:3},{value:"<code>getBackendHealth()</code>",id:"getbackendhealth",level:3},{value:"<code>on(event, handler)</code>",id:"onevent-handler",level:3},{value:"Properties",id:"properties",level:2},{value:"<code>backends</code>",id:"backends",level:3},{value:"<code>strategy</code>",id:"strategy",level:3},{value:"<code>currentBackendIndex</code>",id:"currentbackendindex",level:3},{value:"Types",id:"types",level:2},{value:"<code>RouterOptions</code>",id:"routeroptions",level:3},{value:"<code>RoutingStrategy</code>",id:"routingstrategy",level:3},{value:"<code>CustomStrategyFunction</code>",id:"customstrategyfunction",level:3},{value:"<code>BackendHealthMap</code>",id:"backendhealthmap",level:3},{value:"<code>RouterEvent</code>",id:"routerevent",level:3},{value:"Routing Strategies",id:"routing-strategies",level:2},{value:"Round-Robin",id:"round-robin",level:3},{value:"Random",id:"random",level:3},{value:"Priority (Failover)",id:"priority-failover",level:3},{value:"Weighted",id:"weighted",level:3},{value:"Least-Latency",id:"least-latency",level:3},{value:"Least-Cost",id:"least-cost",level:3},{value:"Custom",id:"custom",level:3},{value:"Health Monitoring",id:"health-monitoring",level:2},{value:"Automatic Health Checks",id:"automatic-health-checks",level:3},{value:"Manual Health Check",id:"manual-health-check",level:3},{value:"Advanced Examples",id:"advanced-examples",level:2},{value:"Cost-Optimized Routing",id:"cost-optimized-routing",level:3},{value:"Multi-Factor Routing",id:"multi-factor-routing",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Automatic Fallback",id:"automatic-fallback",level:3},{value:"Manual Error Handling",id:"manual-error-handling",level:3},{value:"See Also",id:"see-also",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"router-api",children:"Router API"})}),"\n",(0,s.jsxs)(n.p,{children:["Complete API reference for the ",(0,s.jsx)(n.code,{children:"Router"})," class - intelligent routing across multiple backend providers."]}),"\n",(0,s.jsx)(n.h2,{id:"constructor",children:"Constructor"}),"\n",(0,s.jsx)(n.h3,{id:"new-routerfrontendadapter-options",children:(0,s.jsx)(n.code,{children:"new Router(frontendAdapter, options)"})}),"\n",(0,s.jsx)(n.p,{children:"Creates a new Router instance with multiple backend adapters."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"frontendAdapter: FrontendAdapter"})," - Adapter for parsing input format"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"options: RouterOptions"})," - Router configuration"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," ",(0,s.jsx)(n.code,{children:"Router"})," instance"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Router } from 'ai.matey.core';\nimport { OpenAIFrontendAdapter } from 'ai.matey.frontend/openai';\nimport { AnthropicBackendAdapter } from 'ai.matey.backend/anthropic';\nimport { OpenAIBackendAdapter } from 'ai.matey.backend/openai';\n\nconst router = new Router(\n  new OpenAIFrontendAdapter(),\n  {\n    backends: [\n      new AnthropicBackendAdapter({ apiKey: process.env.ANTHROPIC_API_KEY }),\n      new OpenAIBackendAdapter({ apiKey: process.env.OPENAI_API_KEY })\n    ],\n    strategy: 'round-robin',\n    fallbackOnError: true\n  }\n);\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"methods",children:"Methods"}),"\n",(0,s.jsx)(n.h3,{id:"chatrequest",children:(0,s.jsx)(n.code,{children:"chat(request)"})}),"\n",(0,s.jsx)(n.p,{children:"Execute a chat completion request with automatic routing."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"request: any"})," - Request in frontend adapter format"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," ",(0,s.jsx)(n.code,{children:"Promise<any>"})," - Response in frontend adapter format"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Router automatically selects backend based on strategy\nconst response = await router.chat({\n  model: 'gpt-4',\n  messages: [{ role: 'user', content: 'Hello!' }]\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"chatstreamrequest",children:(0,s.jsx)(n.code,{children:"chatStream(request)"})}),"\n",(0,s.jsx)(n.p,{children:"Execute a streaming chat completion request with routing."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"request: any"})," - Request in frontend adapter format (with ",(0,s.jsx)(n.code,{children:"stream: true"}),")"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," ",(0,s.jsx)(n.code,{children:"AsyncIterable<any>"})," - Stream of chunks"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const stream = await router.chatStream({\n  model: 'gpt-4',\n  messages: [{ role: 'user', content: 'Count to 10' }],\n  stream: true\n});\n\nfor await (const chunk of stream) {\n  process.stdout.write(chunk.choices?.[0]?.delta?.content || '');\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"usemiddleware",children:(0,s.jsx)(n.code,{children:"use(middleware)"})}),"\n",(0,s.jsx)(n.p,{children:"Add middleware to all backend adapters."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"middleware: Middleware"})," - Middleware to add"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," ",(0,s.jsx)(n.code,{children:"this"})," (for chaining)"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { createLoggingMiddleware } from 'ai.matey.middleware';\n\nrouter.use(createLoggingMiddleware({ level: 'info' }));\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"addbackendbackend-weight",children:(0,s.jsx)(n.code,{children:"addBackend(backend, weight?)"})}),"\n",(0,s.jsx)(n.p,{children:"Add a new backend adapter to the router."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"backend: BackendAdapter"})," - Backend adapter to add"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"weight?: number"})," - Weight for weighted strategy (default: 1)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," ",(0,s.jsx)(n.code,{children:"void"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { GroqBackendAdapter } from 'ai.matey.backend/groq';\n\nrouter.addBackend(\n  new GroqBackendAdapter({ apiKey: process.env.GROQ_API_KEY }),\n  50 // 50% of traffic if using weighted strategy\n);\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"removebackendbackendname",children:(0,s.jsx)(n.code,{children:"removeBackend(backendName)"})}),"\n",(0,s.jsx)(n.p,{children:"Remove a backend adapter by name."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"backendName: string"})," - Name of backend to remove"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," ",(0,s.jsx)(n.code,{children:"boolean"})," - True if removed, false if not found"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"router.removeBackend('anthropic'); // Returns true if removed\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"setstrategystrategy-customstrategy",children:(0,s.jsx)(n.code,{children:"setStrategy(strategy, customStrategy?)"})}),"\n",(0,s.jsx)(n.p,{children:"Change the routing strategy."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"strategy: RoutingStrategy"})," - Strategy name"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"customStrategy?: CustomStrategyFunction"})," - Custom strategy function (if strategy is 'custom')"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," ",(0,s.jsx)(n.code,{children:"void"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Change to priority strategy\nrouter.setStrategy('priority');\n\n// Or use custom strategy\nrouter.setStrategy('custom', (request, backends) => {\n  // Return index of backend to use\n  return request.messages.length > 10 ? 0 : 1;\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"getbackendhealth",children:(0,s.jsx)(n.code,{children:"getBackendHealth()"})}),"\n",(0,s.jsx)(n.p,{children:"Get health status of all backends."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Parameters:"})," None"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," ",(0,s.jsx)(n.code,{children:"Promise<BackendHealthMap>"})," - Health status for each backend"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const health = await router.getBackendHealth();\n\nconsole.log(health);\n/*\n{\n  anthropic: { healthy: true, latency: 1200, errorRate: 0 },\n  openai: { healthy: true, latency: 1500, errorRate: 0.02 },\n  groq: { healthy: false, latency: 5000, errorRate: 0.5 }\n}\n*/\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"onevent-handler",children:(0,s.jsx)(n.code,{children:"on(event, handler)"})}),"\n",(0,s.jsx)(n.p,{children:"Subscribe to router events."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"event: RouterEvent"})," - Event name"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"handler: Function"})," - Event handler"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," ",(0,s.jsx)(n.code,{children:"void"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Events:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"backend:selected"})," - Fired when a backend is selected"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"backend:failed"})," - Fired when a backend fails"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"backend:switch"})," - Fired when switching to fallback"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"backend:health"})," - Fired on health check"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"router.on('backend:selected', ({ backend, strategy }) => {\n  console.log(`Using ${backend} (strategy: ${strategy})`);\n});\n\nrouter.on('backend:failed', ({ backend, error }) => {\n  console.error(`${backend} failed: ${error.message}`);\n});\n\nrouter.on('backend:switch', ({ from, to, reason }) => {\n  console.log(`Switched from ${from} to ${to}: ${reason}`);\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"properties",children:"Properties"}),"\n",(0,s.jsx)(n.h3,{id:"backends",children:(0,s.jsx)(n.code,{children:"backends"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"BackendAdapter[]"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Read-only"})}),"\n",(0,s.jsx)(n.p,{children:"Array of registered backend adapters."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"strategy",children:(0,s.jsx)(n.code,{children:"strategy"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"RoutingStrategy"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Read-only"})}),"\n",(0,s.jsx)(n.p,{children:"Current routing strategy."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"currentbackendindex",children:(0,s.jsx)(n.code,{children:"currentBackendIndex"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Type:"})," ",(0,s.jsx)(n.code,{children:"number"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Read-only"})}),"\n",(0,s.jsx)(n.p,{children:"Index of the currently selected backend (for stateful strategies)."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"types",children:"Types"}),"\n",(0,s.jsx)(n.h3,{id:"routeroptions",children:(0,s.jsx)(n.code,{children:"RouterOptions"})}),"\n",(0,s.jsx)(n.p,{children:"Configuration options for Router."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface RouterOptions {\n  /** Array of backend adapters */\n  backends: BackendAdapter[];\n\n  /** Routing strategy */\n  strategy: RoutingStrategy;\n\n  /** Custom strategy function (required if strategy is 'custom') */\n  customStrategy?: CustomStrategyFunction;\n\n  /** Enable automatic fallback on error (default: false) */\n  fallbackOnError?: boolean;\n\n  /** Health check configuration */\n  healthCheck?: {\n    enabled: boolean;\n    interval: number; // milliseconds\n    timeout: number;  // milliseconds\n  };\n\n  /** Request timeout (default: 30000ms) */\n  timeout?: number;\n\n  /** Weights for weighted routing */\n  weights?: number[];\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"routingstrategy",children:(0,s.jsx)(n.code,{children:"RoutingStrategy"})}),"\n",(0,s.jsx)(n.p,{children:"Available routing strategies."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"type RoutingStrategy =\n  | 'round-robin'   // Distribute evenly\n  | 'random'        // Random selection\n  | 'priority'      // Use in order, fallback on error\n  | 'weighted'      // Weighted distribution\n  | 'least-latency' // Select fastest backend\n  | 'least-cost'    // Select cheapest backend\n  | 'custom';       // Custom function\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"customstrategyfunction",children:(0,s.jsx)(n.code,{children:"CustomStrategyFunction"})}),"\n",(0,s.jsx)(n.p,{children:"Custom strategy function signature."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"type CustomStrategyFunction = (\n  request: IRChatCompletionRequest,\n  backends: BackendAdapter[],\n  health: BackendHealthMap\n) => number | Promise<number>;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns:"})," Index of backend to use"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const customStrategy: CustomStrategyFunction = (request, backends, health) => {\n  // Route based on message complexity\n  const complexity = analyzeComplexity(request);\n\n  if (complexity < 25) return 0;  // Simple \u2192 Groq\n  if (complexity < 75) return 1;  // Medium \u2192 OpenAI\n  return 2;                       // Complex \u2192 Anthropic\n};\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"backendhealthmap",children:(0,s.jsx)(n.code,{children:"BackendHealthMap"})}),"\n",(0,s.jsx)(n.p,{children:"Health status for each backend."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface BackendHealthMap {\n  [backendName: string]: {\n    healthy: boolean;\n    latency: number;        // Average latency in ms\n    errorRate: number;      // Error rate (0-1)\n    lastCheck: Date;\n    consecutiveFailures: number;\n  };\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"routerevent",children:(0,s.jsx)(n.code,{children:"RouterEvent"})}),"\n",(0,s.jsx)(n.p,{children:"Event types emitted by Router."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"type RouterEvent =\n  | 'backend:selected'\n  | 'backend:failed'\n  | 'backend:switch'\n  | 'backend:health';\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"routing-strategies",children:"Routing Strategies"}),"\n",(0,s.jsx)(n.h3,{id:"round-robin",children:"Round-Robin"}),"\n",(0,s.jsx)(n.p,{children:"Distributes requests evenly across all backends."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const router = new Router(frontend, {\n  backends: [backend1, backend2, backend3],\n  strategy: 'round-robin'\n});\n\n// Request 1 \u2192 Backend 1\n// Request 2 \u2192 Backend 2\n// Request 3 \u2192 Backend 3\n// Request 4 \u2192 Backend 1 (cycles)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use case:"})," Even load distribution, all providers have similar pricing/performance."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"random",children:"Random"}),"\n",(0,s.jsx)(n.p,{children:"Randomly selects a backend for each request."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const router = new Router(frontend, {\n  backends: [backend1, backend2, backend3],\n  strategy: 'random'\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use case:"})," Simple distribution, A/B testing."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"priority-failover",children:"Priority (Failover)"}),"\n",(0,s.jsx)(n.p,{children:"Uses backends in order, falls back if one fails."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const router = new Router(frontend, {\n  backends: [primaryBackend, secondaryBackend, tertiaryBackend],\n  strategy: 'priority',\n  fallbackOnError: true\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use case:"})," High availability, disaster recovery, primary + fallback providers."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"weighted",children:"Weighted"}),"\n",(0,s.jsx)(n.p,{children:"Distributes requests according to weights."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const router = new Router(frontend, {\n  backends: [backend1, backend2, backend3],\n  strategy: 'weighted',\n  weights: [70, 20, 10] // 70%, 20%, 10%\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use case:"})," Canary deployments, gradual provider migration, A/B testing with traffic split."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"least-latency",children:"Least-Latency"}),"\n",(0,s.jsx)(n.p,{children:"Selects the backend with lowest average latency."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const router = new Router(frontend, {\n  backends: [backend1, backend2, backend3],\n  strategy: 'least-latency',\n  healthCheck: {\n    enabled: true,\n    interval: 60000,\n    timeout: 5000\n  }\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use case:"})," Optimize for response time, latency-sensitive applications."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"least-cost",children:"Least-Cost"}),"\n",(0,s.jsx)(n.p,{children:"Selects the cheapest backend based on estimated cost."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const router = new Router(frontend, {\n  backends: [\n    groqBackend,      // $0.00027 per 1K tokens\n    deepseekBackend,  // $0.0002 per 1K tokens\n    openaiBackend     // $0.0015 per 1K tokens\n  ],\n  strategy: 'least-cost'\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use case:"})," Cost optimization, budget-conscious applications."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"custom",children:"Custom"}),"\n",(0,s.jsx)(n.p,{children:"Use your own routing logic."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function selectBackend(request, backends, health) {\n  // Analyze request complexity\n  const wordCount = request.messages\n    .map(m => m.content.split(' ').length)\n    .reduce((a, b) => a + b, 0);\n\n  if (wordCount < 10) return 0;    // Simple \u2192 Fast/cheap\n  if (wordCount < 100) return 1;   // Medium \u2192 Balanced\n  return 2;                        // Complex \u2192 Powerful\n}\n\nconst router = new Router(frontend, {\n  backends: [groqBackend, openaiBackend, anthropicBackend],\n  strategy: 'custom',\n  customStrategy: selectBackend\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use case:"})," Application-specific logic, multi-factor routing."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"health-monitoring",children:"Health Monitoring"}),"\n",(0,s.jsx)(n.h3,{id:"automatic-health-checks",children:"Automatic Health Checks"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const router = new Router(frontend, {\n  backends: [backend1, backend2, backend3],\n  strategy: 'priority',\n  fallbackOnError: true,\n  healthCheck: {\n    enabled: true,\n    interval: 60000,  // Check every minute\n    timeout: 5000     // 5s timeout\n  }\n});\n\n// Monitor health status\nrouter.on('backend:health', ({ backend, healthy, latency }) => {\n  console.log(`${backend}: ${healthy ? '\u2705' : '\u274c'} (${latency}ms)`);\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"manual-health-check",children:"Manual Health Check"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const health = await router.getBackendHealth();\n\nfor (const [name, status] of Object.entries(health)) {\n  if (!status.healthy) {\n    console.log(`\u26a0\ufe0f  ${name} is unhealthy`);\n    console.log(`  Error rate: ${(status.errorRate * 100).toFixed(1)}%`);\n    console.log(`  Consecutive failures: ${status.consecutiveFailures}`);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"advanced-examples",children:"Advanced Examples"}),"\n",(0,s.jsx)(n.h3,{id:"cost-optimized-routing",children:"Cost-Optimized Routing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const PRICING = {\n  groq: 0.00027,\n  deepseek: 0.0002,\n  anthropic: 0.0008,\n  openai: 0.0015\n};\n\nfunction estimateCost(request, backend) {\n  const tokens = estimateTokens(request);\n  const pricePerToken = PRICING[backend.name];\n  return tokens * pricePerToken / 1000;\n}\n\nconst router = new Router(frontend, {\n  backends: [groqBackend, deepseekBackend, anthropicBackend, openaiBackend],\n  strategy: 'custom',\n  customStrategy: (request, backends) => {\n    let cheapestIndex = 0;\n    let lowestCost = Infinity;\n\n    backends.forEach((backend, index) => {\n      const cost = estimateCost(request, backend);\n      if (cost < lowestCost) {\n        lowestCost = cost;\n        cheapestIndex = index;\n      }\n    });\n\n    return cheapestIndex;\n  }\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"multi-factor-routing",children:"Multi-Factor Routing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function intelligentRouting(request, backends, health) {\n  // Factor 1: Health status\n  const healthyBackends = backends.filter((_, i) =>\n    health[backends[i].name]?.healthy !== false\n  );\n\n  if (healthyBackends.length === 0) {\n    return 0; // Fallback to first backend\n  }\n\n  // Factor 2: Request complexity\n  const complexity = analyzeComplexity(request);\n\n  // Factor 3: Time of day (off-peak = cheaper)\n  const hour = new Date().getHours();\n  const isOffPeak = hour < 6 || hour > 22;\n\n  // Routing logic\n  if (complexity > 80) {\n    return backends.findIndex(b => b.name === 'anthropic'); // Most capable\n  }\n\n  if (isOffPeak && complexity < 30) {\n    return backends.findIndex(b => b.name === 'groq'); // Cheapest\n  }\n\n  return backends.findIndex(b => b.name === 'openai'); // Balanced\n}\n\nconst router = new Router(frontend, {\n  backends: [groqBackend, openaiBackend, anthropicBackend],\n  strategy: 'custom',\n  customStrategy: intelligentRouting,\n  healthCheck: { enabled: true, interval: 60000, timeout: 5000 }\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.h3,{id:"automatic-fallback",children:"Automatic Fallback"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const router = new Router(frontend, {\n  backends: [primaryBackend, fallbackBackend],\n  strategy: 'priority',\n  fallbackOnError: true\n});\n\nrouter.on('backend:failed', ({ backend, error }) => {\n  console.error(`\u274c ${backend} failed: ${error.message}`);\n});\n\nrouter.on('backend:switch', ({ from, to }) => {\n  console.log(`\ud83d\udd04 Switched from ${from} to ${to}`);\n});\n\n// If primary fails, automatically uses fallback\nconst response = await router.chat({ ... });\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"manual-error-handling",children:"Manual Error Handling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"try {\n  const response = await router.chat({ ... });\n} catch (error) {\n  if (error instanceof AllBackendsFailedError) {\n    console.error('All backends failed!');\n    error.failures.forEach(({ backend, error }) => {\n      console.error(`  ${backend}: ${error.message}`);\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/api/bridge",children:"Bridge API"})," - Single backend bridge"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/api/middleware",children:"Middleware API"})," - Middleware reference"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/tutorials/beginner/multi-provider",children:"Tutorial: Multi-Provider"})," - Getting started with routing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/johnhenry/ai.matey/tree/main/packages/ai.matey.docs/examples/04-routing",children:"Routing Examples"})," - Code examples"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);