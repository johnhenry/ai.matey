"use strict";(globalThis.webpackChunkai_matey_docs=globalThis.webpackChunkai_matey_docs||[]).push([[192],{1184:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var s=t(4041);const r={},i=s.createContext(r);function a(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:n},e.children)}},1286:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"guides/testing/index","title":"Testing Guide","description":"Comprehensive testing strategy and practices for ai.matey applications.","source":"@site/docs/guides/testing/index.md","sourceDirName":"guides/testing","slug":"/guides/testing/","permalink":"/ai.matey/guides/testing/","draft":false,"unlisted":false,"editUrl":"https://github.com/johnhenry/ai.matey/tree/main/packages/ai.matey.docs/docs/guides/testing/index.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"Intermediate Representation (IR) Format","permalink":"/ai.matey/guides/architecture/ir-format"},"next":{"title":"Integration Patterns","permalink":"/ai.matey/patterns/"}}');var r=t(1085),i=t(1184);const a={sidebar_position:1},c="Testing Guide",d={},o=[{value:"Test Coverage Overview",id:"test-coverage-overview",level:2},{value:"Package Test Status",id:"package-test-status",level:3},{value:"Testing Strategy",id:"testing-strategy",level:2},{value:"1. Unit Testing",id:"1-unit-testing",level:3},{value:"2. Integration Testing",id:"2-integration-testing",level:3},{value:"3. End-to-End Testing",id:"3-end-to-end-testing",level:3},{value:"Mock Backend Adapter",id:"mock-backend-adapter",level:2},{value:"Testing Patterns",id:"testing-patterns",level:2},{value:"Testing Streaming",id:"testing-streaming",level:3},{value:"Testing Error Handling",id:"testing-error-handling",level:3},{value:"Testing Middleware",id:"testing-middleware",level:3},{value:"Testing Router Failover",id:"testing-router-failover",level:3},{value:"Test Utilities",id:"test-utilities",level:2},{value:"Request Assertion Helper",id:"request-assertion-helper",level:3},{value:"Response Assertion Helper",id:"response-assertion-helper",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Use Environment Variables",id:"1-use-environment-variables",level:3},{value:"2. Mock External Dependencies",id:"2-mock-external-dependencies",level:3},{value:"3. Test Rate Limiting",id:"3-test-rate-limiting",level:3},{value:"4. Test Cleanup",id:"4-test-cleanup",level:3},{value:"Performance Testing",id:"performance-testing",level:2},{value:"Latency Testing",id:"latency-testing",level:3},{value:"Throughput Testing",id:"throughput-testing",level:3},{value:"Continuous Integration",id:"continuous-integration",level:2},{value:"GitHub Actions Example",id:"github-actions-example",level:3},{value:"See Also",id:"see-also",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"testing-guide",children:"Testing Guide"})}),"\n",(0,r.jsx)(n.p,{children:"Comprehensive testing strategy and practices for ai.matey applications."}),"\n",(0,r.jsx)(n.admonition,{title:"Test Coverage",type:"success",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test Suite"}),": 14 integration applications + unit tests"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Overall Pass Rate"}),": 100% (core packages)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Production Validation"}),": \u2705 Complete"]}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"test-coverage-overview",children:"Test Coverage Overview"}),"\n",(0,r.jsx)(n.h3,{id:"package-test-status",children:"Package Test Status"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Package"}),(0,r.jsx)(n.th,{children:"Unit Tests"}),(0,r.jsx)(n.th,{children:"Integration Tests"}),(0,r.jsx)(n.th,{children:"Pass Rate"}),(0,r.jsx)(n.th,{children:"Status"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ai.matey.core"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"}),(0,r.jsx)(n.td,{children:"\u2705 Yes (4/4)"}),(0,r.jsx)(n.td,{children:"100%"}),(0,r.jsx)(n.td,{children:"Production-ready"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ai.matey.backend"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"}),(0,r.jsx)(n.td,{children:"\u2705 Yes (24 providers)"}),(0,r.jsx)(n.td,{children:"100%"}),(0,r.jsx)(n.td,{children:"Production-ready"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ai.matey.frontend"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"}),(0,r.jsx)(n.td,{children:"\u2705 Yes (7 adapters)"}),(0,r.jsx)(n.td,{children:"100%"}),(0,r.jsx)(n.td,{children:"Production-ready"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ai.matey.middleware"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"}),(0,r.jsx)(n.td,{children:"\u2705 Yes (4/4 types)"}),(0,r.jsx)(n.td,{children:"100%"}),(0,r.jsx)(n.td,{children:"Production-ready"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ai.matey.http"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"}),(0,r.jsx)(n.td,{children:"\u2705 Yes (6/6 tests)"}),(0,r.jsx)(n.td,{children:"100%"}),(0,r.jsx)(n.td,{children:"Production-ready"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ai.matey.wrapper"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"}),(0,r.jsx)(n.td,{children:"\u2705 Yes (28/28)"}),(0,r.jsx)(n.td,{children:"100%"}),(0,r.jsx)(n.td,{children:"Production-ready"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ai.matey.cli"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"}),(0,r.jsx)(n.td,{children:"\u2705 Yes (9/9)"}),(0,r.jsx)(n.td,{children:"100%"}),(0,r.jsx)(n.td,{children:"Production-ready"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ai.matey.react.hooks"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"}),(0,r.jsx)(n.td,{children:"\u2705 Yes (build)"}),(0,r.jsx)(n.td,{children:"100%"}),(0,r.jsx)(n.td,{children:"Production-ready"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ai.matey.utils"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"}),(0,r.jsx)(n.td,{children:"\u2705 Yes (50+ utils)"}),(0,r.jsx)(n.td,{children:"100%"}),(0,r.jsx)(n.td,{children:"Production-ready"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ai.matey.types"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"}),(0,r.jsx)(n.td,{children:"100%"}),(0,r.jsx)(n.td,{children:"Production-ready"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"testing-strategy",children:"Testing Strategy"}),"\n",(0,r.jsx)(n.h3,{id:"1-unit-testing",children:"1. Unit Testing"}),"\n",(0,r.jsx)(n.p,{children:"Test individual components in isolation with mocked dependencies."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { Bridge } from 'ai.matey.core';\nimport { MockBackendAdapter } from '../test-utils';\n\ndescribe('Bridge', () => {\n  it('should process chat requests', async () => {\n    const mockBackend = new MockBackendAdapter({\n      response: {\n        choices: [{ message: { content: 'Mock response' } }]\n      }\n    });\n\n    const bridge = new Bridge(\n      new OpenAIFrontendAdapter(),\n      mockBackend\n    );\n\n    const response = await bridge.chat({\n      model: 'gpt-4',\n      messages: [{ role: 'user', content: 'Hello' }]\n    });\n\n    expect(response.choices[0].message.content).toBe('Mock response');\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-integration-testing",children:"2. Integration Testing"}),"\n",(0,r.jsx)(n.p,{children:"Test multiple components working together."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { Bridge } from 'ai.matey.core';\nimport { OpenAIBackendAdapter } from 'ai.matey.backend/openai';\nimport { OpenAIFrontendAdapter } from 'ai.matey.frontend/openai';\n\ndescribe('OpenAI Integration', () => {\n  it('should make real API calls', async () => {\n    const bridge = new Bridge(\n      new OpenAIFrontendAdapter(),\n      new OpenAIBackendAdapter({ apiKey: process.env.OPENAI_API_KEY })\n    );\n\n    const response = await bridge.chat({\n      model: 'gpt-3.5-turbo',\n      messages: [{ role: 'user', content: 'Say hello' }],\n      max_tokens: 10\n    });\n\n    expect(response.choices).toHaveLength(1);\n    expect(response.choices[0].message.content).toBeTruthy();\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-end-to-end-testing",children:"3. End-to-End Testing"}),"\n",(0,r.jsx)(n.p,{children:"Test complete user flows with real services."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import request from 'supertest';\nimport { app } from '../server';\n\ndescribe('HTTP API E2E', () => {\n  it('should handle chat requests', async () => {\n    const response = await request(app)\n      .post('/v1/chat/completions')\n      .send({\n        model: 'gpt-4',\n        messages: [{ role: 'user', content: 'Test' }]\n      })\n      .expect(200);\n\n    expect(response.body.choices).toBeDefined();\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"mock-backend-adapter",children:"Mock Backend Adapter"}),"\n",(0,r.jsx)(n.p,{children:"Create deterministic tests with a mock adapter:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"class MockBackendAdapter {\n  private responses: Map<string, any> = new Map();\n\n  setResponse(key: string, response: any) {\n    this.responses.set(key, response);\n  }\n\n  async chat(request: any): Promise<any> {\n    const key = JSON.stringify(request.messages);\n    const response = this.responses.get(key);\n\n    return response || {\n      id: 'mock-123',\n      choices: [{ message: { content: 'Default mock response' } }]\n    };\n  }\n\n  async *chatStream(request: any): AsyncGenerator<any> {\n    const chunks = ['Mock', ' ', 'streaming', ' ', 'response'];\n\n    for (const chunk of chunks) {\n      yield {\n        choices: [{ delta: { content: chunk } }]\n      };\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"testing-patterns",children:"Testing Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"testing-streaming",children:"Testing Streaming"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"it('should handle streaming responses', async () => {\n  const stream = await bridge.chatStream({\n    model: 'gpt-4',\n    messages: [{ role: 'user', content: 'Count to 5' }],\n    stream: true\n  });\n\n  let fullText = '';\n  for await (const chunk of stream) {\n    if (chunk.choices?.[0]?.delta?.content) {\n      fullText += chunk.choices[0].delta.content;\n    }\n  }\n\n  expect(fullText.length).toBeGreaterThan(0);\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"testing-error-handling",children:"Testing Error Handling"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"it('should handle backend errors gracefully', async () => {\n  const failingBackend = new MockBackendAdapter();\n  failingBackend.setError(new Error('API Error'));\n\n  const bridge = new Bridge(\n    new OpenAIFrontendAdapter(),\n    failingBackend\n  );\n\n  await expect(\n    bridge.chat({\n      model: 'gpt-4',\n      messages: [{ role: 'user', content: 'Hello' }]\n    })\n  ).rejects.toThrow('API Error');\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"testing-middleware",children:"Testing Middleware"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"it('should execute middleware in order', async () => {\n  const order: string[] = [];\n\n  const middleware1 = {\n    name: 'middleware-1',\n    async execute(request, next) {\n      order.push('before-1');\n      const response = await next(request);\n      order.push('after-1');\n      return response;\n    }\n  };\n\n  const middleware2 = {\n    name: 'middleware-2',\n    async execute(request, next) {\n      order.push('before-2');\n      const response = await next(request);\n      order.push('after-2');\n      return response;\n    }\n  };\n\n  bridge.use(middleware1);\n  bridge.use(middleware2);\n\n  await bridge.chat({ /* ... */ });\n\n  expect(order).toEqual([\n    'before-1',\n    'before-2',\n    'after-2',\n    'after-1'\n  ]);\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"testing-router-failover",children:"Testing Router Failover"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"it('should failover to secondary backend', async () => {\n  const primary = new MockBackendAdapter();\n  primary.setError(new Error('Primary failed'));\n\n  const secondary = new MockBackendAdapter();\n  secondary.setResponse('*', { content: 'Fallback response' });\n\n  const router = new Router(new OpenAIFrontendAdapter(), {\n    backends: [primary, secondary],\n    strategy: 'priority',\n    fallbackOnError: true\n  });\n\n  const response = await router.chat({\n    model: 'gpt-4',\n    messages: [{ role: 'user', content: 'Test' }]\n  });\n\n  expect(response.content).toBe('Fallback response');\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"test-utilities",children:"Test Utilities"}),"\n",(0,r.jsx)(n.h3,{id:"request-assertion-helper",children:"Request Assertion Helper"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"function assertChatRequest(request: any) {\n  expect(request).toBeDefined();\n  expect(request.model).toBeTruthy();\n  expect(request.messages).toBeInstanceOf(Array);\n  expect(request.messages.length).toBeGreaterThan(0);\n\n  request.messages.forEach((msg: any) => {\n    expect(msg.role).toMatch(/^(system|user|assistant|tool)$/);\n    expect(msg.content).toBeTruthy();\n  });\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"response-assertion-helper",children:"Response Assertion Helper"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"function assertChatResponse(response: any) {\n  expect(response).toBeDefined();\n  expect(response.id).toBeTruthy();\n  expect(response.choices).toBeInstanceOf(Array);\n  expect(response.choices.length).toBeGreaterThan(0);\n\n  const choice = response.choices[0];\n  expect(choice.message).toBeDefined();\n  expect(choice.message.role).toBe('assistant');\n  expect(choice.message.content).toBeTruthy();\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"1-use-environment-variables",children:"1. Use Environment Variables"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// test.env\nOPENAI_API_KEY=sk-test-...\nANTHROPIC_API_KEY=sk-ant-test-...\n\n// test setup\nimport dotenv from 'dotenv';\ndotenv.config({ path: '.env.test' });\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-mock-external-dependencies",children:"2. Mock External Dependencies"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"jest.mock('ai.matey.backend/openai', () => ({\n  OpenAIBackendAdapter: jest.fn().mockImplementation(() => ({\n    chat: jest.fn().mockResolvedValue({ /* mock response */ })\n  }))\n}));\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-test-rate-limiting",children:"3. Test Rate Limiting"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"it('should respect rate limits', async () => {\n  const limiter = new RateLimiter({ maxRequests: 5, windowMs: 1000 });\n\n  const requests = Array(10).fill(null).map(() =>\n    limiter.execute(async () => 'done')\n  );\n\n  const startTime = Date.now();\n  await Promise.all(requests);\n  const duration = Date.now() - startTime;\n\n  // Should take at least 1 second (due to rate limit)\n  expect(duration).toBeGreaterThanOrEqual(1000);\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-test-cleanup",children:"4. Test Cleanup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"afterEach(async () => {\n  // Clear caches\n  await cache.clear();\n\n  // Close connections\n  await db.close();\n\n  // Reset mocks\n  jest.clearAllMocks();\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"performance-testing",children:"Performance Testing"}),"\n",(0,r.jsx)(n.h3,{id:"latency-testing",children:"Latency Testing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"it('should meet latency requirements', async () => {\n  const start = Date.now();\n\n  await bridge.chat({\n    model: 'gpt-3.5-turbo',\n    messages: [{ role: 'user', content: 'Quick test' }],\n    max_tokens: 10\n  });\n\n  const duration = Date.now() - start;\n\n  expect(duration).toBeLessThan(5000); // <5s\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"throughput-testing",children:"Throughput Testing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"it('should handle high throughput', async () => {\n  const requests = 100;\n  const startTime = Date.now();\n\n  await Promise.all(\n    Array(requests).fill(null).map(() =>\n      bridge.chat({ /* ... */ })\n    )\n  );\n\n  const duration = (Date.now() - startTime) / 1000;\n  const rps = requests / duration;\n\n  expect(rps).toBeGreaterThan(10); // >10 req/s\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"continuous-integration",children:"Continuous Integration"}),"\n",(0,r.jsx)(n.h3,{id:"github-actions-example",children:"GitHub Actions Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"name: Test\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v3\n        with:\n          node-version: '18'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run tests\n        run: npm test\n        env:\n          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}\n          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}\n\n      - name: Upload coverage\n        uses: codecov/codecov-action@v3\n"})}),"\n",(0,r.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/johnhenry/ai.matey/tree/main/packages/ai.matey.docs/examples/07-advanced-patterns",children:"Testing Patterns Example"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);