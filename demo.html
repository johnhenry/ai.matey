<!DOCTYPE html>
<html>
  <head>
    <title>My Demo</title>
    <script type="importmap">
      {
        "imports": {
          "ai.matey/openai": "https://cdn.jsdelivr.net/npm/ai.matey@0.0.1/openai/index.mjs",
          "ai.matey/mock": "https://cdn.jsdelivr.net/npm/ai.matey@0.0.1/mock/index.mjs",
          "ai.matey/mock/polyfill": "https://cdn.jsdelivr.net/npm/ai.matey@0.0.1/mock/polyfill.mjs",
          "ai.matey/mock/pollyfill-ovewrite": "https://cdn.jsdelivr.net/npm/ai.matey@0.0.1/mock/polyfill-overwrite.mjs"
        }
      }
    </script>
  </head>
  <body>
    <h1>AI Demo</h1>
    <p>Check console</p>
    <script type="module">
      import ai from "./mock/index.mjs";
      import AI from "./openai/index.mjs";
      //
      const MOCK = false;
      const OLLAMA = true;
      const WINDOW_AI = false;
      //
      const BASIC_PROMPT = "Write a poem about space travel";
      const LONG_CONTENT = `Once upon a time, in a land far away, there
      was a beautiful princess who loved to explore the world around her. She had a heart full of curiosity and a mind full of wonder. Every day, she would set out on a new adventure, discovering the magic and beauty of her kingdom. She would climb the highest mountains, swim in the deepest oceans, and soar through the sky on the wings of a dragon. She would meet new friends and learn new things, and she would always return home with a smile on her face and a story to tell. The princess's kingdom was a place of wonder and enchantment, where anything was possible and dreams could come true. And the princess knew that as long as she had her curiosity and her sense of wonder, she would always find new adventures and new friends to share them with.`;
      const WRITE_INSTRUCTIONS = `Write a story about a princess who loves to explore the world around her. Use your imagination and creativity to bring the story to life. You can include details about the princess's kingdom, her adventures, and the friends she meets along the way. Be sure to use descriptive language and vivid imagery to make the story engaging and captivating. Have fun and let your creativity shine!`;
      //
      if (MOCK) {
        try {
          console.log("1. Call using mock implementation.");
          const model = await ai.languageModel.create({
            context: "You are an expert in creating poery.",
            temperature: 0.7,
            topK: 1,
            maxTokens: 200,
            seed: 1,
          });
          const poem = await model.prompt(BASIC_PROMPT);
          console.log("1. Mock response");
          console.log(poem);
        } catch (e) {
          console.error("1. Mock error");
          console.error(e);
        }
      }
      if (OLLAMA) {
        try {
          console.log("2. Call to Ollama via openai-compatible client.");
          const ai = new AI({
            endpoint: "http://localhost:11434/v1/chat/completions",
            credentials: {
              apiKey: "123",
            },
            model: "llama3.2:latest",
          });
          const model = await ai.languageModel.create({
            context: "You are an expert in creating poery.",
            temperature: 0.7,
            topK: 1,
            maxTokens: 200,
            seed: 1,
          });
          const poem = await model.prompt(BASIC_PROMPT);
          model.destroy();
          console.log("2. Ollama response");
          console.log(poem);
          const summarizer = await ai.summarizer.create({
            context: "You are an expert in creating poery.",
            maxTokens: 200,
            seed: 1,
          });
          const summary = await summarizer.summarize(LONG_CONTENT);
          summarizer.destroy();
          console.log("2. Ollama summary");
          console.log(summary);
          const writer = await ai.writer.create({
            context: "You are an old-timey storyteller.",
            temperature: 0.7,
            topK: 1,
            maxTokens: 200,
            seed: 1,
          });
          const story = await writer.write(WRITE_INSTRUCTIONS);
          writer.destroy();
          console.log("2. Ollama writer");
          console.log(story);
          const rewriter = await ai.rewriter.create({
            tone: "more-formal",
          });
          const rewritten = await rewriter.rewrite(LONG_CONTENT);
          rewriter.destroy();
          console.log("2. Ollama rewriter");
          console.log(rewritten);
        } catch (e) {
          console.error("2. Ollama error");
          console.error(e);
        }
      }
      if (WINDOW_AI) {
        try {
          console.log("3. Built-in ai (if available)");
          const model = await window.ai.languageModel.create({
            context: "You are an expert in creating poery.",
            temperature: 0.7,
            topK: 1,
            maxTokens: 200,
            seed: 1,
          });
          const poem = await model.prompt(BASIC_PROMPT);
          model.destroy();
          console.log("3. Built-in ai response");
          console.log(poem);
          const summarizer = await window.ai.summarizer.create({
            context: "You are an expert in creating poery.",
            maxTokens: 200,
            seed: 1,
          });
          const summary = await summarizer.summarize(LONG_CONTENT);
          summarizer.destroy();
          console.log("3. Built-in ai summary");
          console.log(summary);
          const writer = await window.ai.writer.create({
            context: "You are an old-timey storyteller.",
            temperature: 0.7,
            topK: 1,
            maxTokens: 200,
            seed: 1,
          });
          const story = await writer.write(WRITE_INSTRUCTIONS);
          writer.destroy();
          console.log("3. Built-in ai writer");
          console.log(story);
          const rewriter = await window.ai.rewriter.create({
            context: "You are an expert in creating poery.",
            tone: "as-is",
          });
          const rewritten = await rewriter.rewrite(LONG_CONTENT);
          rewriter.destroy();
          console.log("3. Built-in ai rewriter");
          console.log(rewritten);
        } catch (e) {
          console.error("3. Built-in ai error");
          console.error(e);
        }
      }
      console.log("fin");
    </script>
  </body>
</html>
